# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Проект интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Особенности реализации:
— товар не должен добавляться в корзину дважды;
Проект разработан в парадигме MVP.

## Данные и типы данных, используемые в приложении

Интерфейс, который описывает продукт(товар)

```
interface IProductItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
	status: boolean;
}
```

Интерфейс, который описывает каталог продуктов(список товаров)

```
export interface IProducts {
	total: number;
	items: IProductItem[];
}
```

Интерфейс, который описывает данные товара

```
interface IOrder {
    payment: string | null;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}
```

Интерфейс, который описывает оформленный заказ

```
interface IOrderResult {
    id: string[];
    total: number;
    error?: string;
}
```

Интерфейс, который описывает главную стрпницу

```
interface IPage {
    counter: number;
	catalog: HTMLElement[];
    locked: boolean;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

Дополнительно реализованы методы onAll и offAll — для подписки на все события и сброса всех
подписчиков.

#### Абстрактный класс Component

Самый главный класс для всех элементов представления.
Основные методы, реализуемые классом:

- `setText` - метод устанавливает текстовое содержимое
- `setDisable` - метод статуса блокировки
- `setHiden` - метод скрывает элемент
- `setVisible` - метод показывает элемент
- `setImage` - метод устанавливает изображение
- `render` - метод возвращает элемент разметки, для отображнения на странице

#### Абстрактный класс Model

Kласс модели данных
Содержит метод `emitChanges`, который создаёт уникальное событие

### Слой данных

#### Класс AppState

Класс хранит данные о каталоге товаров и заказе пользователя, а также логика работы с данными.

Методы:

- `addBasket` - добавляет продукт в корзину по его идентификатору, если он уже не добавлен.

- `removeBasket` - удаляет продукт из корзины по его идентификатору.

- `getBasket` - возвращает массив товаров, которые находятся в корзине.

- `setPreview` - устанавливает идентификатор продукта для предварительного просмотра.

- `setCatalog` - устанавливает каталог товаров и общее количество доступных товаров.

- `getTotalPrice` - рассчитывает и возвращает общую стоимость товаров в корзине.

- `clearBasket` - очищает все товары из корзины.

- `clearOrder` - сбрасывает информацию о текущем заказе.

- `setOrderField` - устанавливает значение определенного поля в объекте заказа.

- `validateOrder` - проверяет, заполнены ли обязательные поля в заказе, и устанавливает соответствующие ошибки.

#### Класс UserDataForm

Класс для покупки товара

Методы:

- `set address` — устанавливает адрес доставки в соответствующее поле формы.

- `set payment` — устанавливает способ оплаты и эмитирует событие изменения способа оплаты.

#### Класс Contacts

Класс для покупки товара

Методы:

- `set phone` — устанавливает номер телефона в соответствующее поле формы.

- `set email` — устанавливает адрес электронной почты в соответствующее поле формы.

#### Класс WebStoreApi

Методы:

- `getProductsList` — получает список всех доступных продуктов с сервера.
- `getProductItem` — получает детальную информацию о продукте по его идентификатору.
- `orderProducts` — отправляет информацию о заказе на сервер и возвращает результат выполнения операции.

### Слой отображения

#### Класс Basket

Класс отображения корзины
Поля класса:

```
_list: HTMLElement - элемент
_total: HTMLElement - счётчик элементов
_button: HTMLButtonElement - кнопка для отправки формы

```

Методы:

- `set items` — устанавливает элементы товаров в корзине.
- `set total` — устанавливает общую стоимость товаров в корзине.

#### Класс Product

Класс для карточки товара

Методы:

title , category , price , image , description — геттеры и сеттеры для свойств продукта. id — Уникальный идентификатор продукта. setText , setImage — вспомогательные методы для установки текста и изображений.

CatalogItem

status — отображает доступность продукта в каталоге.

BasketItem

index — позиция продукта в корзине.

#### Modal

Класс для модальных окон

Поля класса:

```
_closeButton: HTMLButtonElement - кнопка закрытия модального окна

_content: HTMLElement-  контент модального окна, всё его содержимое

```

Методы:

- `open`- метод откырытия модального окна
- `close` - метод закрытия модального окна
- `rander` - метод отображения модального окна на странице

#### Success

Класс для успешной покупки

Методы:

- `set title(value: string)` — устанавливает текст заголовка уведомления.
  value: string — текст заголовка.
- `set description(value: string)` — устанавливает текст описания уведомления.
  value: string — текст описания.

#### Page

Класс для отображения всего каталога товаров, всей главной страницы.
Поля класса:

```
_counter: HTMLElement - элемент для отображения количества товаров в корзине

_catalog: HTMLElement - элемент отображения каталога товаров

_wrapper: HTMLElement - элемент-обертка основного контента страницы

_basket: HTMLElement - элемент корзины на странице

```

Методы:

- `set counter` — Устанавливает количество товаров в корзине.
- `set catalog` — Обновляет каталог товаров на странице.
- `set locked` — Блокирует или разблокирует основной интерфейс пользователя.

### Презентор

index.ts содержится код, отвечающий за взаимодействие данных между собой с помощью событий.

#### События возникающие при взаимодействии клиента с приложением:

```
enum Events {
  ITEMS_CHANGED = 'items:changed' - изменение списка товаров
  ADD_PRODUCT = 'cart:add-product'- добавление товара в корзину
  REMOVE_PRODUCT = 'cart:remove-product' - удаление товара из корзины
  CREATE_ORDER = 'cart:create-order' - Создание заказа из корзины
  BASKET_OPEN = 'cart:open' - открытие корзины пользователя
  OPEN_PREVIEW = 'product:open-preview' - открытие детального просмотра товара
  CHANGED_PREVIEW = 'product:changed-preview' - обновление детального просмотра товара
  FORM_ERRORS_CHANGE = 'form:errors-changed' - изменение ошибок в формах
  ORDER_OPEN = 'order:open' - открытие формы заказа
  ORDER_CLEAR = 'order:clear' - очистка данных заказа
  SET_PAYMENT_METHOD = 'order:set-payment-method' - установка метода оплаты
  MODAL_OPEN = 'modal:open' - открытие модального окна
  MODAL_CLOSE = 'modal:close' - закрытие модального окна
}
```
