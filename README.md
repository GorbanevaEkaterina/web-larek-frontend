# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Проект интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Особенности реализации:
— товар не должен добавляться в корзину дважды;
Проект разработан в парадигме MVP.

## Данные и типы данных, используемые в приложении

Интерфейс, который описывает продукт(товар)

```
interface IProductItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

Интерфейс, который описывает каталог продуктов(список товаров)

```
interface IProductList {
    total: number;
    catalog: IProductItem[];
    basket: string[];
    order: IOrder | null;
    loading: boolean;
    preview: string | null;
}
```

Интерфейс, который описывает покупателя(пользователя данного магазина)

```
interface IUser {
    email: string;
    phone: number;
    address: string;
}
```

Интерфейс, который описывает форму для покупки товара

```
interface IOrderForm {
    payment: string;
    email: string;
    phone: string;
    address: string;
}
```

Интерфейс, который описывает корзину с товарами, до оформления

```
interface IOrder extends IOrderForm {
    id: string;
    items: string[]
}
```

Интерфейс, который описывает результат покупки товаров

```
interface IOrderResult {
    id: string;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

Дополнительно реализованы методы onAll и offAll — для подписки на все события и сброса всех
подписчиков.

#### Абстрактный класс Component

Самый главный класс для всех элементов представления.
Основные методы, реализуемые классом:

- `setText` - метод устанавливает текстовое содержимое
- `setDisable` - метод статуса блокировки
- `setHiden` - метод скрывает элемент
- `setVisible` - метод показывает элемент
- `setImage` - метод устанавливает изображение
- `render` - метод возвращает элемент разметки, для отображнения на странице

#### Абстрактный класс Model

Kласс модели данных
Содержит метод `emitChanges`, который создаёт уникальное событие

### Слой данных

#### Класс AppState

Класс хранит данные о каталоге товаров и заказе пользователя, а также логика работы с данными.

Методы:

- `setCatalog`- добавляет карточки товаров в каталог
- `setPreview` - метод добавляет id выбранного товара в preview
- `setOrderField` - после ввода данных пользователем добавляет их объект\ для дальнейшей работы
- `validateOrder`- валидация данных пользователя

### Слой отображения

#### Класс Basket

Класс отображения корзины
Поля класса:

```
_list: HTMLElement - элемент
_total: HTMLElement - счётчик элементов
_button: HTMLButtonElement - кнопка для отправки формы

```

Методы:

```
onInputChange	метод изменения данных в полях формы и добовляет событие ${this.container.name}.${String(field)}: change
render	метод возвращает элемент формы для отображения на странице

```

#### Класс Card

Класс для карточки товара

Поля класса:

```
_title: HTMLElement - элемент для отображения названия товара

_image?: HTMLImageElement- элемент изображения товара

_category?: HTMLElement - элемент для отображения категории товара

_price: HTMLElement - элемент для отображения цены товара

```

#### Класс Order

Класс для покупки товара

Поля класса:

```
cardPay: HTMLButtonElement - кнопка оплаты картой, безналичная оплата
cashPay: HTMLButtonElement - кнопка оплаты за наличный расчёт

```

#### Modal

Класс для модальных окон

Поля класса:

```
_closeButton: HTMLButtonElement - кнопка закрытия модального окна

_content: HTMLElement-  контент модального окна, всё его содержимое

```

Методы:

- `open`- метод откырытия модального окна
- `close` - метод закрытия модального окна
- `rander` - метод отображения модального окна на странице

#### Success

Класс для успешной покупки

Поля класса:

```

_close: HTMLButtonElement - кнопка

_total: HTMLElement - элемент суммы списания

```

#### Page

Класс для отображения всего каталога товаров, всей главной страницы.
Поля класса:

```
_counter: HTMLElement - элемент для отображения количества товаров в корзине

_catalog: HTMLElement - элемент отображения каталога товаров

_wrapper: HTMLElement - элемент-обертка основного контента страницы

_basket: HTMLElement - элемент корзины на странице

```

### Презентор

index.ts содержится код, отвечающий за взаимодействие данных между собой с помощью событий.

#### События возникающие при взаимодействии клиента с приложением:

- `card: selected`-клик по карточке товара в каталоге
- `modal: open`- открытие модального окна
- `modal: close`- закрытие модального окна
- `basket: open`- открытие корзины
- `order: open` - открытие формы адреса доставки
- `clientContacts: open`- открытие формы с контактами клиента
- `order: submit`- отправка формы
- `clientContacts: submit` - оформление заказа

#### События изменения данных:

- `items: changed` - изменение каталога товаров
- `preview: changed` - изменение выбранной карточки товара
- `basket: changed`- изменение состояния корзины
- `order: ready` - данные в полях формы прошли вариацию
- `formError: change` - изменение при ошибки в валидации формы
