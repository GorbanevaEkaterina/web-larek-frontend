# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Проект интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Особенности реализации:
— товар не должен добавляться в корзину дважды;
Проект разработан в парадигме MVP.

## Данные и типы данных, используемые в приложении

Интерфейс товара в приложении.

```
interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}

```

Интерфейс для хранения состояния всего приложения.

```
interface IAppState {
    catalog: IProductItem[];
    preview: string | null;
    order: IOrder | null;
	formErrors: FormErrors;
	basket: IProductItem[];

}

```

Интерфейс для представления состояния страницы.

```
interface IPage {
	counter: number;
	catalog: HTMLElement[];
	locked: boolean;
	basket: HTMLElement;
	wrapper: HTMLElement;
}

```

Интерфейс для представления структуры корзины.

```
interface IBasket {
	items: IProductItem[];
}

```

Интерфейс для управления состоянием формы.

```
interface IFormState {
	valid: boolean;
	errors: string[];
}

```

Интерфейс для представления информации о заказе.

```
interface IOrder {
	payment: string;
	email: string;
	phone: string;
	address: string;

}

```

Интерфейс для описания действий, связанных с продуктом.

````
interface IProductActions {
	onClick: (event: MouseEvent) => void;
}

```

Интерфейс для представления результатов оформления заказа.
```
interface IOrderResult {
	id: string;
	total: number;

}
```

Интерфейс для представления успешного результата операции.

```
interface ISuccess {
	total: number;
}
```

Тип, представляющий объект, который может содержать ошибки формы. Ключами являются ключи из IOrder, а значениями — строки с описанием ошибок.

```
type FormErrors = Partial<Record<keyof IOrder, string>>;

```

Интерфейс для представления отдельных деталей продукта.

```
interface IProduct {
	id: string;
	description?: string;
	image?: string;
	title: string;
	category?: string;
	price: number | null;
	buttonText?: string;
	index?: number;
	selected?: boolean;
}
```

Интерфейс для представления товара в корзине.
```
interface IBasketProduct {
	title: string;
	price: number | null;
	index: number;
}
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

Дополнительно реализованы методы onAll и offAll — для подписки на все события и сброса всех
подписчиков.

#### Абстрактный класс Component

Самый главный класс для всех элементов представления.
Основные методы, реализуемые классом:

- `setText` - метод устанавливает текстовое содержимое
- `setDisable` - метод статуса блокировки
- `setHiden` - метод скрывает элемент
- `setVisible` - метод показывает элемент
- `setImage` - метод устанавливает изображение
- `render` - метод возвращает элемент разметки, для отображнения на странице

#### Абстрактный класс Model

Kласс модели данных
Содержит метод `emitChanges`, который создаёт уникальное событие

### Слой данных

#### Класс AppState

Класс хранит данные о каталоге товаров и заказе пользователя, а также логика работы с данными.

Методы:

- `addBasket` - добавляет продукт в корзину по его идентификатору, если он уже не добавлен.

- `removeBasket` - удаляет продукт из корзины по его идентификатору.

- `getBasketCount` - счётчик товаров в корзине.

- `setPreview` - устанавливает идентификатор продукта для предварительного просмотра.

- `setCatalog` - устанавливает каталог товаров и общее количество доступных товаров.

- `getTotalPrice` - рассчитывает и возвращает общую стоимость товаров в корзине.

- `clearBasket` - очищает все товары из корзины.

- `clearOrder` - сбрасывает информацию о текущем заказе.

- `setOrderField` - устанавливает значение определенного поля в объекте заказа.

- `validateOrder` - проверяет, заполнены ли обязательные поля в заказе, и устанавливает соответствующие ошибки.
- `inBasket` - проверяет, есть товар с определённым id в корзине.
- `getProductIDs` - формирует массив id.

#### Класс WebStoreApi

Методы:

- `getProductsList` — получает список всех доступных продуктов с сервера.
- `getProductItem` — получает детальную информацию о продукте по его идентификатору.
- `orderProducts` — отправляет информацию о заказе на сервер и возвращает результат выполнения операции.

### Слой отображения

#### Класс Basket

Класс отображения корзины
Поля класса:

```
_list: HTMLElement - список товаров
_total: HTMLElement - стоимость
_button: HTMLButtonElement - кнопка для отправки формы

```

Методы:

- `set list` — устанавливает элементы товаров в корзине.
- `set total` — устанавливает общую стоимость товаров в корзине.
- `disableButton` - доступность кнопки.

#### Класс Product

Класс `Product` представляет отдельный товар на веб-странице. Вот его описание:

Поля класса:

- `_id: HTMLElement` - элемент, содержащий идентификатор товара.
- `_title: HTMLElement` - элемент, отображающий название товара.
- `_price: HTMLElement` - элемент, отображающий цену товара.
- `_button?: HTMLButtonElement` - необязательный элемент кнопки для взаимодействия с товаром.

Методы:

- `get id(): string` - возвращает идентификатор товара.
- `set id(value: string)` - устанавливает идентификатор товара.
- `get title(): string` - возвращает название товара.
- `set title(value: string)` - устанавливает название товара.
- `set buttonText(value: string)` - устанавливает текст на кнопке товара (если кнопка присутствует).
- `set price(value: number | null)` - устанавливает цену товара. Если цена равна `null`, отображается сообщение "Бесценно", и кнопка (если присутствует) становится неактивной.

#### Modal

Класс для модальных окон

Поля класса:

```
_closeButton: HTMLButtonElement - кнопка закрытия модального окна
_content: HTMLElement-  контент модального окна, всё его содержимое

```

Методы:

- `open`- метод откырытия модального окна
- `close` - метод закрытия модального окна
- `rander` - метод отображения модального окна на странице

#### Success

Класс для успешной покупки
Вот его описание:

Поля класса:

- `_close: HTMLButtonElement` - кнопка для закрытия сообщения об успешном заказе.
- `_total: HTMLElement` - элемент, содержащий информацию о списанных синапсах.

Методы:

- `set total(value: string)` - устанавливает текстовое содержимое элемента `_total`, выводя количество списанных синапсов после успешного заказа.

#### Page

Класс для отображения всего каталога товаров, всей главной страницы.
Поля класса:

```
_counter: HTMLElement - элемент для отображения количества товаров в корзине

_catalog: HTMLElement - элемент отображения каталога товаров

_wrapper: HTMLElement - элемент-обертка основного контента страницы

_basket: HTMLElement - элемент корзины на странице

_locked: boolean - флаг, указывающий, заблокирована ли обертка страницы.

```

Методы:

- `set counter` — Устанавливает количество товаров в корзине.
- `set catalog` — Обновляет каталог товаров на странице.
- `set locked` — Блокирует или разблокирует основной интерфейс пользователя.

#### ProductCatalog

Класс `ProductCatalog` расширяет класс `Product` и представляет каталог продуктов. Вот его описание:

Поля класса:

- `_selected: boolean` - флаг, указывающий выбран ли продукт.
- `_image: HTMLImageElement` - элемент изображения продукта на карточке.
- `_category: HTMLElement` - элемент категории продукта на карточке.
- `_categoryColor: Map<string, string="">` - словарь, сопоставляющий названия категорий с соответствующими классами для стилизации.

Методы:

- `set category(value: string)` - устанавливает категорию продукта на карточке и применяет соответствующий класс для стилизации.
- `set image(value: string)` - устанавливает изображение продукта на карточке.

#### CatalogProdactsView

также расширяет класс `ProductCatalog` и представляет представление продукта в каталоге. Он добавляет поле `_description` для отображения описания продукта. Вот его описание:

Дополнительное поле:

- `_description: HTMLElement` - элемент описания продукта на карточке.

Методы:

- `set description(value: string | string[])` - устанавливает описание продукта на карточке. Может быть передано как строка или массив строк.

#### BasketProduct

также расширяет класс `Product` и представляет продукт в корзине. Он добавляет поле `_index` для отображения индекса продукта в корзине. Вот его описание:

Дополнительное поле:

- `_index: HTMLElement` - элемент индекса продукта в корзине.

Методы:

- `set index(value: number)` - устанавливает индекс продукта в корзине.</string,>

#### Form

представляет собой компонент формы, обрабатывающий ввод данных и отправку формы.
Поля класса:

```
_submit: HTMLButtonElement - кнопка отправки формы.

_errors: HTMLElement - элемент, отображающий ошибки валидации формы.
```

Методы:

- `onInputChange` - oбрабатывает изменения в полях формы, эмитируя событие input:change.
- `set valid` - устанавливает состояние кнопки отправки (активна/неактивна) в зависимости от валидности формы.
- `set errors` - отображает сообщения об ошибках в соответствующем элементе.
- `render`- обновляет состояние формы, включая валидность и ошибки, и заполняет поля ввода значениями из состояния.

#### Order

обеспечивает удобный интерфейс для ввода информации о заказе, позволяя пользователю легко выбирать способ оплаты и указывать адрес, а также эффективно обрабатывает изменения состояния формы

Поля класса:

```
_onlineButton: HTMLButtonElement - кнопка для выбора онлайн-оплаты.
_cashButton: HTMLButtonElement - кнопка для выбора оплаты наличными.
_address: HTMLInputElement - поле для ввода адреса доставки.

```

Методы:

- set address - устанавливает значение поля адреса доставки.
- set payment - устанавливает выбранный способ оплаты и добавляет/удаляет классы активности для соответствующих кнопок.

#### Contacts

для сбора контактных данных

Поля класса:

```
_inputPhone: HTMLInputElement - поле ввода для номера телефона.

_inputEmail: HTMLInputElement - поле ввода для адреса электронной почты.

```

Методы:

- `set phone` - устанавливает значение поля для ввода телефона. При этом проверяет, что элемент \_inputPhone существует перед присвоением значения.
- `set email`- устанавливает значение поля для ввода электронной почты, также проверяя наличие элемента \_inputEmail.

### Презентор

index.ts содержится код, отвечающий за взаимодействие данных между собой с помощью событий.

#### События возникающие при взаимодействии клиента с приложением:

```
catalog:changed:
- Событие триггерится для обновления каталога товаров. Обновляется представление каталога с новыми продуктами.

modal:open:
- При открытии модального окна блокируется прокрутка страницы, устанавливается page.locked = true.

modal:close:
- При закрытии модального окна разблокируется прокрутка страницы, устанавливается page.locked = false.

card:select:
- Событие, которое срабатывает при выборе отдельной карточки товара.
- Создаётся и отображается карточка товара в модальном окне, где можно добавить товар в корзину или удалить его.

basket:changed:
- Событие, вызываемое при изменении корзины. Обновляется общее количество товаров в корзине и список товаров в представлении корзины.

card:toBasket:
- Событие, срабатывающее при добавлении товара в корзину. Товар добавляется в корзину и модальное окно закрывается.

card:deleteFromBasket:
- Событие для удаления товара из корзины. Товар удаляется из корзины и модальное окно закрывается.

сounter:change:
- Событие, которое обновляет счётчик товаров в корзине, отображая актуальное количество.

basket:open:
- Открывает модальное окно с содержимым корзины.

order:open:
- Открывает модальное окно для оформления заказа с предустановленной информацией о выборе оплаты и адресе.

orderErrors:change:
- Обработчик для изменения ошибок при оформлении заказа. Проверяет наличие ошибок и обновляет валидность формы заказа.

input:change:
- Событие, которое обрабатывает изменения в полях ввода формы для заказа. Изменения сохраняются в данных заказа.

order:submit:
- Событие, которое открывает модальное окно для ввода контактной информации.

contactsErrors:change:
- Событие для обработки ошибок ввода контактной информации. Проверяет ошибки и обновляет валидность формы контактов.

contacts:submit:
- При отправке контактной информации осуществляется попытка заказать товары. Если запрос успешен, корзина и заказ очищаются, и показывается сообщение об успешном завершении.

```
````
